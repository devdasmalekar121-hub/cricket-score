<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chhotu Pro Scorer + History</title>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@700;900&family=Oswald:wght@500;700&display=swap');
        :root { --primary: #fec309; --blue: #1a73e8; --red: #ff0040; --green: #00c853; --bg: #030a16; }

        body { background: var(--bg); color: white; font-family: 'Oswald', sans-serif; margin: 0; padding-bottom: 50px; }
        
        /* Dashboard Header */
        .master-header { background: #000; padding: 5px 15px; display: flex; justify-content: space-between; font-family: 'Orbitron'; font-size: 10px; border-bottom: 1px solid #222; }
        .main-board { background: linear-gradient(90deg, #00122e 0%, #002b6b 100%); display: flex; align-items: center; height: 65px; border-bottom: 3px solid var(--primary); position: relative; }
        .team-name { background: var(--primary); color: #000; font-family: 'Orbitron'; font-weight: 900; padding: 0 15px; height: 100%; display: flex; align-items: center; clip-path: polygon(0 0, 85% 0, 100% 100%, 0% 100%); min-width: 80px; }
        .score-val { font-size: 35px; font-weight: 900; font-family: 'Orbitron'; padding-left: 10px; }
        .ov-val { font-size: 14px; opacity: 0.6; margin-left: 5px; }
        
        /* Layouts */
        .admin-container { padding: 15px; max-width: 1000px; margin: auto; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 15px; }
        .card { background: #0a1221; padding: 15px; border-radius: 8px; border: 1px solid #1a2a44; }
        
        /* Buttons */
        .btn-group { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; margin-bottom: 10px; }
        button { padding: 12px 5px; border-radius: 4px; border: none; font-weight: 700; cursor: pointer; text-transform: uppercase; font-size: 11px; }
        .btn-b { background: var(--blue); color: #fff; }
        .btn-r { background: var(--red); color: #fff; }
        .btn-y { background: var(--primary); color: #000; }
        .btn-g { background: var(--green); color: #fff; width: 100%; margin-bottom: 8px; }
        .btn-dark { background: #1c2533; color: white; width: 100%; border: 1px solid #333; margin-bottom: 8px; }

        input { width: 92%; padding: 10px; margin-bottom: 8px; background: #050e1a; border: 1px solid #1a2a44; color: #fff; border-radius: 4px; }
        
        /* History Section */
        .history-panel { margin-top: 20px; border-top: 1px solid #333; padding-top: 20px; }
        .history-item { background: #0a1221; padding: 10px; border-radius: 6px; margin-bottom: 8px; border-left: 4px solid var(--primary); }
        
        #alert-box { position: fixed; top: 40%; width: 100%; text-align: center; font-size: 50px; font-family: 'Orbitron'; font-weight: 900; display: none; z-index: 5000; }
        .hidden { display: none !important; }
    </style>
</head>
<body onload="initApp()">

    <div id="alert-box"></div>

    <div class="master-header">
        <span id="d-tour">TOURNAMENT</span>
        <span id="d-clock">00:00 PM</span>
    </div>

    <div class="main-board">
        <div class="team-name" id="d-t1">TEAM</div>
        <div class="score-val">
            <span id="d-r">0</span>-<span id="d-w">0</span>
            <span class="ov-val">(<span id="d-ov">0.0</span>)</span>
        </div>
        <div style="flex-grow:1; padding: 0 15px; font-size: 12px; font-family: 'Orbitron';">
            <div id="p1-row" style="color:var(--primary)"> <span id="d-p1">BAT 1</span> <span id="d-p1r">0(0)</span></div>
            <div id="p2-row"> <span id="d-p2">BAT 2</span> <span id="d-p2r">0(0)</span></div>
        </div>
    </div>

    <div class="admin-container">
        <div id="login-view" style="text-align: center; padding: 50px;">
            <input type="password" id="pin" placeholder="ENTER PIN" style="text-align: center; font-size: 20px;">
            <button class="btn-y" onclick="login()" style="width:100%">UNLOCK DASHBOARD</button>
        </div>

        <div id="admin-view" class="hidden">
            <div class="grid">
                <div class="card">
                    <p style="font-size: 10px; color: #555; margin:0 0 10px 0;">QUICK SCORING</p>
                    <div class="btn-group">
                        <button class="btn-b" onclick="score(1)">+1</button>
                        <button class="btn-b" onclick="score(2)">+2</button>
                        <button class="btn-b" onclick="score(3)">+3</button>
                        <button class="btn-r" onclick="score(-1)">-1</button>
                    </div>
                    <div class="btn-group">
                        <button class="btn-y" onclick="score(4)">4</button>
                        <button class="btn-y" onclick="score(6)">6</button>
                        <button class="btn-r" onclick="wicket()" style="grid-column: span 2;">WICKET</button>
                    </div>
                    <div class="btn-group">
                        <button class="btn-b" onclick="extra('WD')">WIDE</button>
                        <button class="btn-b" onclick="extra('NB')">NO BALL</button>
                        <button class="btn-b" onclick="extra('BYE')">BYES</button>
                        <button class="btn-b" onclick="swap()">SWAP</button>
                    </div>
                    <button class="btn-g" onclick="dotBall()">NEXT BALL (DOT)</button>
                    <button class="btn-dark" onclick="toggleAuto()" id="auto-btn">AUTO STRIKE: ON</button>
                    <button class="btn-r" onclick="saveMatch()" style="width:100%">END & SAVE MATCH</button>
                </div>

                <div class="card">
                    <p style="font-size: 10px; color: #555; margin:0 0 10px 0;">MATCH SETUP</p>
                    <input type="text" id="i-tour" placeholder="Tournament Name" oninput="sync()">
                    <input type="text" id="i-t1" placeholder="Batting Team" oninput="sync()">
                    <input type="text" id="i-p1" placeholder="Striker" oninput="sync()">
                    <input type="text" id="i-p2" placeholder="Non-Striker" oninput="sync()">
                    <input type="text" id="i-bwl" placeholder="Current Bowler" oninput="sync()">
                </div>
            </div>

            <div class="history-panel">
                <h3 style="color:var(--primary); font-family:'Orbitron'; font-size:14px;">MATCH HISTORY ARCHIVE</h3>
                <div id="history-list"></div>
            </div>
        </div>
    </div>

    <script>
        const firebaseConfig = { databaseURL: "Https://myscoreboard-b140f-default-rtdb.firebaseio.com/" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database().ref("live_match_v4");
        const histDb = firebase.database().ref("match_history");

        let state = { r:0, w:0, o:0, b:0, t:"TEAM", tour:"TOURNAMENT", p1:{n:"BAT 1", r:0, b:0}, p2:{n:"BAT 2", r:0, b:0}, s:1, auto:true, bwl:"WAITING", freeHit:false };

        function login() { if(document.getElementById('pin').value === "ChhotuLive8718") { localStorage.setItem("admin", "true"); location.reload(); } }
        function initApp() {
            if(localStorage.getItem("admin") === "true") { document.getElementById('login-view').classList.add('hidden'); document.getElementById('admin-view').classList.remove('hidden'); }
            db.on('value', snap => { if(snap.val()) { state = snap.val(); updateUI(); } });
            loadHistory();
            setInterval(() => { document.getElementById('d-clock').innerText = new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}); }, 1000);
        }

        function score(v) { 
            if(v > 0) {
                state.r += v; if(state.s === 1) state.p1.r += v; else state.p2.r += v;
                if(v === 4) showAlert("FOUR", "#fec309"); if(v === 6) showAlert("SIX", "#fec309");
                if(state.auto && (v === 1 || v === 3)) swap();
            } else { state.r = Math.max(0, state.r - 1); }
            state.freeHit = false; db.set(state); 
        }

        function extra(type) { 
            state.r += 1; if(type === 'NB') { state.freeHit = true; showAlert("FREE HIT", "#ff0040"); } 
            db.set(state); 
        }

        function dotBall() { 
            if(state.s === 1) state.p1.b++; else state.p2.b++; state.b++;
            if(state.b >= 6) { state.o++; state.b = 0; if(state.auto) swap(); }
            state.freeHit = false; db.set(state); 
        }

        function wicket() { 
            if(state.freeHit) return alert("FREE HIT!");
            let n = prompt("NEW BATSMAN:");
            if(n) { state.w++; if(state.s === 1) state.p1 = {n:n, r:0, b:0}; else state.p2 = {n:n, r:0, b:0}; db.set(state); }
        }

        function swap() { state.s = state.s === 1 ? 2 : 1; db.set(state); }
        function toggleAuto() { state.auto = !state.auto; db.set(state); }

        function sync() {
            state.tour = document.getElementById('i-tour').value || state.tour;
            state.t = document.getElementById('i-t1').value || state.t;
            state.p1.n = document.getElementById('i-p1').value || state.p1.n;
            state.p2.n = document.getElementById('i-p2').value || state.p2.n;
            state.bwl = document.getElementById('i-bwl').value || state.bwl;
            db.set(state);
        }

        function updateUI() {
            document.getElementById('d-r').innerText = state.r; document.getElementById('d-w').innerText = state.w;
            document.getElementById('d-ov').innerText = `${state.o}.${state.b}`;
            document.getElementById('d-t1').innerText = state.t; document.getElementById('d-p1').innerText = state.p1.n;
            document.getElementById('d-p1r').innerText = `${state.p1.r}(${state.p1.b})`;
            document.getElementById('d-p2').innerText = state.p2.n;
            document.getElementById('d-p2r').innerText = `${state.p2.r}(${state.p2.b})`;
            document.getElementById('p1-row').style.color = state.s === 1 ? "var(--primary)" : "white";
            document.getElementById('p2-row').style.color = state.s === 2 ? "var(--primary)" : "white";
            document.getElementById('auto-btn').innerText = state.auto ? "AUTO STRIKE: ON" : "AUTO STRIKE: OFF";
        }

        function showAlert(t, c) { const b = document.getElementById('alert-box'); b.innerText = t; b.style.color = c; b.style.display = 'block'; setTimeout(() => b.style.display='none', 2000); }

        function saveMatch() {
            if(confirm("SAVE THIS MATCH TO HISTORY?")) {
                histDb.push({ tour: state.tour, teams: state.t, score: `${state.r}/${state.w}`, overs: `${state.o}.${state.b}`, date: new Date().toLocaleDateString() });
                db.set({ r:0, w:0, o:0, b:0, t:"TEAM", tour:"TOURNAMENT", p1:{n:"BAT 1", r:0, b:0}, p2:{n:"BAT 2", r:0, b:0}, s:1, auto:true, bwl:"WAITING", freeHit:false });
            }
        }

        function loadHistory() {
            histDb.on('value', snap => {
                const list = document.getElementById('history-list'); list.innerHTML = "";
                const data = snap.val(); if(!data) return;
                Object.values(data).reverse().forEach(m => {
                    list.innerHTML += `<div class="history-item"><strong>${m.teams}</strong>: ${m.score} (${m.overs}) <br> <small>${m.date} - ${m.tour}</small></div>`;
                });
            });
        }
    </script>
</body>
</html>
