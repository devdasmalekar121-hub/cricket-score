<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chhotu Live Ultra-Max 2026 | Broadcaster Pro</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@600;800;900&family=Oswald:wght@500;700&family=Roboto+Condensed:wght@700&display=swap');
        
        :root { 
            --primary: #fec309; 
            --neon-blue: #00e1ff; 
            --neon-red: #ff0040; 
            --bg: #020812; 
            --card-bg: #0d1626;
            --glass: rgba(255, 255, 255, 0.1);
            --font-main: 'Orbitron', sans-serif;
        }

        body { 
            background: var(--bg); 
            color: white; 
            font-family: 'Oswald', sans-serif; 
            margin: 0; 
            padding-bottom: 80px; 
            overflow-x: hidden; 
            font-weight: 700;
        }

        /* --- BROADCAST OVERLAY SYSTEM --- */
        .master-container { 
            width: 100%; 
            max-width: 1200px; 
            margin: auto; 
            position: sticky; 
            top: 0; 
            z-index: 9999; 
            background: #000;
            box-shadow: 0 25px 60px rgba(0,0,0,0.95);
        }

        .top-info-bar { 
            background: linear-gradient(90deg, #000, #111, #000); 
            color: #ffffff; 
            font-family: var(--font-main); 
            font-size: 14px; 
            padding: 12px 25px; 
            display: flex; 
            justify-content: space-between; 
            border-bottom: 2px solid #222;
            letter-spacing: 2px;
            font-weight: 900;
            text-transform: uppercase;
        }

        .main-board { 
            height: 110px; 
            background: linear-gradient(90deg, #001229 0%, #002d5c 50%, #001229 100%);
            display: flex; 
            align-items: center; 
            position: relative; 
            overflow: hidden;
            border-bottom: 7px solid var(--primary);
            transition: all 0.5s ease;
        }

        /* FX BANNER (WICKET/SIX/FOUR) */
        #fx-banner {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            display: none;
            align-items: center;
            justify-content: center;
            font-family: var(--font-main);
            font-size: 70px;
            font-weight: 900;
            z-index: 1000;
            animation: bounceIn 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        .fx-wicket { background: var(--neon-red) !important; color: white !important; }
        .fx-six { background: var(--primary) !important; color: black !important; }
        .fx-four { background: var(--neon-blue) !important; color: black !important; }

        .team-identity { 
            background: var(--primary); 
            color: #000; 
            font-weight: 900; 
            font-size: 34px;
            padding: 0 45px; 
            height: 100%; 
            display: flex; 
            align-items: center;
            clip-path: polygon(0 0, 92% 0, 100% 100%, 0% 100%); 
            font-family: var(--font-main); 
            min-width: 180px;
        }

        /* SCORE NUMBERS WITH ROLLING ANIMATION */
        .score-display { 
            font-size: 65px; 
            font-weight: 900; 
            padding: 0 35px; 
            font-family: var(--font-main); 
            display: flex; 
            align-items: baseline;
            color: #fff;
            text-shadow: 0 0 15px rgba(255,255,255,0.2);
        }

        .num-box {
            display: inline-block;
            transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .pop-it {
            animation: rolling 0.5s ease-out;
            color: var(--primary);
        }
        @keyframes rolling {
            0% { transform: scale(1.5) rotateX(90deg); filter: brightness(2); }
            100% { transform: scale(1) rotateX(0deg); filter: brightness(1); }
        }

        .ov-tag { font-size: 26px; color: #bbb; margin-left: 18px; font-weight: 900; }

        .batsmen-info { 
            flex-grow: 1; 
            padding: 0 35px; 
            border-left: 4px solid rgba(255,255,255,0.15);
        }

        .player-row { 
            font-size: 20px; 
            display: flex; 
            justify-content: space-between; 
            margin: 8px 0; 
            font-family: var(--font-main);
            font-weight: 900;
        }

        .striker-active { 
            color: var(--primary); 
            background: rgba(255,255,255,0.08);
            padding: 3px 12px;
            border-radius: 6px;
            box-shadow: inset 0 0 10px rgba(254,195,9,0.2);
        }

        .opp-summary { 
            background: rgba(0,225,255,0.12); 
            height: 100%; 
            padding: 0 30px; 
            display: flex; 
            flex-direction: column; 
            justify-content: center; 
            text-align: right; 
            min-width: 190px; 
            border-left: 4px solid rgba(0,225,255,0.4);
        }

        .bottom-nav-strip { 
            background: #000; 
            padding: 18px 35px; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            border-top: 3px solid #111;
        }

        /* --- BALL TRACKER --- */
        .ball-tracker { display: flex; gap: 12px; }
        .ball-circle { 
            width: 38px; height: 38px; background: #0a0a0a; 
            border-radius: 50%; display: flex; align-items: center; 
            justify-content: center; font-size: 18px; border: 3px solid #333; 
            color: #666; font-family: var(--font-main); font-weight: 900;
            transition: all 0.3s ease;
        }
        .ball-circle.filled { 
            background: var(--primary); color: #000; 
            box-shadow: 0 0 25px var(--primary); border:none;
            transform: scale(1.2);
        }

        /* --- ADMIN DASHBOARD --- */
        .admin-main { padding: 50px; max-width: 1400px; margin: auto; }
        .admin-card { 
            background: var(--card-bg); padding: 40px; border-radius: 30px; 
            border: 2px solid #1e2a44; margin-bottom: 35px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.7);
        }

        .section-header { 
            color: var(--primary); font-size: 16px; font-weight: 900; 
            text-transform: uppercase; letter-spacing: 4px; margin-bottom: 30px;
            display: flex; align-items: center; gap: 15px;
        }
        .section-header::after { content:""; flex-grow:1; height:2px; background:#1e2a44; }

        .btn-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 30px; }
        
        button { 
            padding: 24px 10px; font-weight: 900; border: none; border-radius: 18px; 
            cursor: pointer; font-family: 'Oswald'; text-transform: uppercase;
            font-size: 18px; transition: transform 0.1s, filter 0.2s;
            box-shadow: 0 8px 0 rgba(0,0,0,0.3);
        }
        button:hover { filter: brightness(1.1); }
        button:active { transform: translateY(5px); box-shadow: 0 2px 0 rgba(0,0,0,0.3); }

        .btn-blue { background: #1a73e8; color: white; border-bottom: 6px solid #0d47a1; }
        .btn-yellow { background: var(--primary); color: #000; border-bottom: 6px solid #b78a00; }
        .btn-red { background: var(--neon-red); color: white; border-bottom: 6px solid #a00028; }
        .btn-green { background: #00c853; color: white; border-bottom: 8px solid #007e33; }
        .btn-dark { background: #1e2a44; color: #cbd5e1; border-bottom: 6px solid #0f172a; }

        input { 
            width: 98%; padding: 20px; margin-bottom: 25px; 
            background: #020812; border: 2px solid #1e2a44; 
            color: white; border-radius: 15px; font-family: var(--font-main);
            font-weight: 900; font-size: 18px; transition: 0.3s;
        }
        input:focus { border-color: var(--primary); background: #050e1f; }

        .hidden { display: none !important; }

        /* Timeline History */
        .history-ribbon { 
            display: flex; gap: 15px; flex-wrap: wrap; margin-top: 25px; 
            background: #020812; padding: 20px; border-radius: 20px;
        }
        .ball-item { 
            background: #1e2a44; padding: 12px 22px; border-radius: 35px; 
            font-size: 18px; color: var(--primary); border: 2px solid var(--primary);
            font-family: var(--font-main); font-weight: 900;
        }

    </style>
</head>
<body onload="initApp()">

    <div class="master-container">
        <div class="top-info-bar">
            <span><span id="d-tour">CHHOTU CHAMPIONS TROPHY 2026</span> | <span id="d-proj" style="color:var(--primary)">PROJ: 0</span></span>
            <span id="d-clock">12:00:00 AM</span>
        </div>
        
        <div class="main-board" id="main-board-container">
            <div id="fx-banner">BOUNDARY!</div>

            <div class="team-identity" id="d-team">TEAM A</div>
            
            <div class="score-display">
                <span id="d-runs" class="num-box">0</span>-<span id="d-wkt" class="num-box">0</span>
                <span class="ov-tag">(<span id="d-ov">0.0</span>)</span>
            </div>
            
            <div class="batsmen-info">
                <div id="p1-row" class="player-row striker-active">
                    <span id="d-b1">PLAYER 1</span> <span id="d-b1-r">0 (0)</span>
                </div>
                <div id="p2-row" class="player-row">
                    <span id="d-b2">PLAYER 2</span> <span id="d-b2-r">0 (0)</span>
                </div>
            </div>

            <div class="opp-summary">
                <span style="font-size: 12px; color: var(--neon-blue); font-weight: 900;">OPPONENT</span>
                <span id="d-opp-score" style="font-size: 22px; font-weight: 900;">120-5 (15.2)</span>
                <span style="font-size: 14px; opacity: 1; margin-top: 6px; font-weight: 900;">TARGET: <span id="d-target" style="color:var(--primary)">121</span></span>
            </div>
        </div>

        <div class="bottom-nav-strip">
            <div id="d-status" style="font-family:var(--font-main); font-size:16px; color:#fff; font-weight: 900;">LIVE STREAMING ENGINE ACTIVE</div>
            <div style="display: flex; align-items: center; gap: 30px;">
                <span style="font-family:var(--font-main); font-size:14px; color:var(--primary); font-weight: 900;">BOWL: <span id="d-bowl" style="color:white; text-transform: uppercase;">AWAITING</span></span>
                <div class="ball-tracker" id="d-dots">
                    <div class="ball-circle">1</div><div class="ball-circle">2</div><div class="ball-circle">3</div>
                    <div class="ball-circle">4</div><div class="ball-circle">5</div><div class="ball-circle">6</div>
                </div>
            </div>
        </div>
    </div>

    <div class="admin-main">
        
        <div id="login-section" class="admin-card" style="text-align: center; max-width: 600px; margin: 60px auto;">
            <h1 style="font-family:var(--font-main); color:var(--primary); font-size: 40px;">SECURE LOGIN</h1>
            <p style="color:#666; margin-bottom:40px;">Enter Pin to Access Control Panel</p>
            <input type="password" id="pass-input" placeholder="••••••••" style="text-align:center; font-size: 35px; letter-spacing: 10px;">
            <button class="btn-yellow" onclick="checkAuth()" style="width:100%; height:90px; font-size:26px;">UNLOCK DASHBOARD</button>
        </div>

        <div id="dashboard-section" class="hidden">
            <div class="admin-card" style="display:flex; justify-content:space-between; align-items:center;">
                <h2 style="margin:0; font-family:var(--font-main); color:var(--primary)">ULTRA-PRO DASHBOARD v5.0</h2>
                <div style="display:flex; gap:20px;">
                    <button class="btn-dark" onclick="archiveMatchData()" style="padding:10px 25px;">ARCHIVE MATCH</button>
                    <button class="btn-red" onclick="lockPanel()" style="padding:10px 25px;">LOGOUT</button>
                </div>
            </div>

            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(450px, 1fr)); gap: 40px;">
                
                <div class="admin-card">
                    <span class="section-header">Match Score Engine</span>
                    
                    <button class="btn-green" onclick="processNextBall()" style="width:100%; font-size:32px; height:120px; margin-bottom:30px;">NEXT BALL (DOT)</button>
                    
                    <div class="btn-grid">
                        <button class="btn-blue" onclick="processRun(1)">+1</button>
                        <button class="btn-blue" onclick="processRun(2)">+2</button>
                        <button class="btn-blue" onclick="processRun(3)">+3</button>
                        <button class="btn-red" onclick="processRun(-1)">-1</button>
                    </div>
                    <div class="btn-grid">
                        <button class="btn-yellow" onclick="processRun(4)">FOUR (4)</button>
                        <button class="btn-yellow" onclick="processRun(6)">SIX (6)</button>
                        <button class="btn-red" onclick="processWicket()" style="grid-column: span 2; font-size: 24px;">WICKET (OUT)</button>
                    </div>
                    <div class="btn-grid">
                        <button class="btn-dark" onclick="processExtra('WD')">WD</button>
                        <button class="btn-dark" onclick="processExtra('NB')">NB</button>
                        <button class="btn-dark" onclick="processExtra('LB')">LB</button>
                        <button class="btn-dark" onclick="manualStrikeSwap()">SWAP</button>
                    </div>
                    
                    <div style="display:flex; gap:20px;">
                        <button id="auto-btn" class="btn-dark" onclick="toggleStrikeMode()" style="flex:1">AUTO STRIKE: ON</button>
                        <button id="inn-btn" class="btn-yellow" onclick="switchInnings()" style="width:140px;">INN 1</button>
                    </div>
                </div>

                <div class="admin-card">
                    <span class="section-header">System Configuration</span>
                    <input type="text" id="i-tour" placeholder="TOURNAMENT TITLE" oninput="pushState()">
                    <input type="text" id="i-t1" placeholder="BATTING TEAM NAME" oninput="pushState()">
                    <input type="text" id="i-b1" placeholder="STRIKER (PLAYER 1)" oninput="pushState()">
                    <input type="text" id="i-b2" placeholder="NON-STRIKER (PLAYER 2)" oninput="pushState()">
                    <input type="text" id="i-bowl" placeholder="CURRENT BOWLER" oninput="pushState()">
                    <div style="display:flex; gap:20px;">
                        <input type="number" id="i-target" placeholder="TARGET" oninput="pushState()">
                        <input type="number" id="i-max-ov" placeholder="MAX OVERS" oninput="pushState()">
                    </div>
                    <input type="text" id="i-opp-score" placeholder="OPPONENT SUMMARY (0-0 0.0)" oninput="pushState()">
                </div>
            </div>

            <div class="admin-card">
                <span class="section-header">Live Analytics & Timeline</span>
                <div id="over-analysis" class="history-ribbon"></div>
                
                <div style="margin-top:40px; display:grid; grid-template-columns: repeat(4, 1fr); gap:25px;">
                    <div style="background:#020812; padding:25px; border-radius:20px; border-top: 4px solid var(--primary);">
                        <span style="color:#555; font-size:12px; font-weight:900;">PARTNERSHIP</span>
                        <div id="v-pship" style="font-size:28px; color:var(--primary); font-family:var(--font-main);">0 (0)</div>
                    </div>
                    <div style="background:#020812; padding:25px; border-radius:20px; border-top: 4px solid var(--neon-blue);">
                        <span style="color:#555; font-size:12px; font-weight:900;">RUN RATE</span>
                        <div id="v-crr" style="font-size:28px; color:var(--neon-blue); font-family:var(--font-main);">0.00</div>
                    </div>
                    <div style="background:#020812; padding:25px; border-radius:20px; border-top: 4px solid var(--neon-red);">
                        <span style="color:#555; font-size:12px; font-weight:900;">RR REQ</span>
                        <div id="v-rrr" style="font-size:28px; color:var(--neon-red); font-family:var(--font-main);">0.00</div>
                    </div>
                    <div style="background:#020812; padding:25px; border-radius:20px; border-top: 4px solid #00c853;">
                        <span style="color:#555; font-size:12px; font-weight:900;">TOTAL BALLS</span>
                        <div id="v-balls" style="font-size:28px; color:#00c853; font-family:var(--font-main);">0</div>
                    </div>
                </div>
            </div>

            <div class="admin-card" style="border-top: 10px solid var(--neon-red);">
                <span class="section-header">Master Match History</span>
                <div id="history-list"></div>
                <button class="btn-red" onclick="fullSystemReset()" style="width:100%; margin-top:30px; height:70px;">EMERGENCY DATA WIPE</button>
            </div>

        </div>
    </div>

    <script>
        // --- FIREBASE CONFIG ---
        const firebaseConfig = { databaseURL: "Https://myscoreboard-b140f-default-rtdb.firebaseio.com/" };
        firebase.initializeApp(firebaseConfig);
        const refMain = firebase.database().ref("broadcast_v2026_final_master");
        const refHist = firebase.database().ref("history_v2026_final_master");

        // --- GLOBAL STATE OBJECT ---
        let matchState = {
            r: 0, w: 0, o: 0, b: 0,
            tName: "TEAM A", tourName: "CHHOTU PREMIER LEAGUE",
            oppInfo: "0-0 (0.0)", targetVal: 0,
            strikePos: 1, 
            bat1: { n: "PLAYER 1", r: 0, b: 0 },
            bat2: { n: "PLAYER 2", r: 0, b: 0 },
            pship: { r: 0, b: 0 },
            bowler: "READY",
            inningNum: 1, maxOvers: 20, autoStrike: true, 
            animType: "", 
            overTimeline: [] 
        };

        // --- AUTH SYSTEM ---
        function checkAuth() {
            const pin = document.getElementById('pass-input').value;
            if(pin === "ChhotuLive8718") {
                localStorage.setItem("pro_access_v5", "true");
                showDashboard();
            } else { 
                alert("ACCESS DENIED: INCORRECT PIN"); 
                document.getElementById('pass-input').value = "";
            }
        }

        function showDashboard() {
            document.getElementById('dashboard-section').classList.remove('hidden');
            document.getElementById('login-section').classList.add('hidden');
        }

        function lockPanel() {
            localStorage.removeItem("pro_access_v5");
            location.reload();
        }

        // --- INITIALIZATION ---
        function initApp() {
            if(localStorage.getItem("pro_access_v5") === "true") showDashboard();
            
            // Clock
            setInterval(() => {
                document.getElementById('d-clock').innerText = new Date().toLocaleTimeString();
            }, 1000);

            // DB Listener
            refMain.on('value', snap => {
                const data = snap.val();
                if(data) {
                    // Animations on data change
                    if(data.r !== matchState.r) applyNumberPop('d-runs');
                    if(data.w !== matchState.w) applyNumberPop('d-wkt');
                    
                    matchState = data;
                    updateUI();
                    if(localStorage.getItem("pro_access_v5") === "true") syncInputs();
                }
            });
            fetchHistory();
        }

        // --- ANIMATION CONTROLLER ---
        function applyNumberPop(id) {
            const el = document.getElementById(id);
            el.classList.add('pop-it');
            setTimeout(() => el.classList.remove('pop-it'), 500);
        }

        function triggerOverlayFX(type, text) {
            matchState.animType = type; // e.g., 'fx-wicket'
            const banner = document.getElementById('fx-banner');
            banner.innerText = text;
            banner.className = type;
            banner.style.display = 'flex';
            
            // Red board effect on wicket
            if(type === 'fx-wicket') {
                document.getElementById('main-board-container').style.background = "var(--neon-red)";
            }

            saveState();

            setTimeout(() => {
                banner.style.display = 'none';
                document.getElementById('main-board-container').style.background = "";
                matchState.animType = "";
                saveState();
            }, 4000);
        }

        // --- CORE SCORING LOGIC ---
        function processRun(val) {
            matchState.r += val;
            matchState.pship.r += val;
            
            if(matchState.strikePos === 1) matchState.bat1.r += val; 
            else matchState.bat2.r += val;
            
            if(val === 4) triggerOverlayFX("fx-four", "FOUR!");
            if(val === 6) triggerOverlayFX("fx-six", "SIX!");
            
            if(matchState.autoStrike && (val === 1 || val === 3)) manualStrikeSwap();
            if(val >= 0) matchState.overTimeline.push(val);
            
            saveState();
        }

        function processExtra(type) {
            matchState.r += 1;
            matchState.pship.r += 1;
            matchState.overTimeline.push(type);
            if(type === 'NB') triggerOverlayFX("fx-six", "FREE HIT!");
            saveState();
        }

        function processNextBall() {
            if(matchState.strikePos === 1) matchState.bat1.b++; 
            else matchState.bat2.b++;
            
            matchState.pship.b++;
            matchState.b++;
            
            if(matchState.b >= 6) {
                matchState.o++; 
                matchState.b = 0;
                if(matchState.autoStrike) manualStrikeSwap();
                matchState.overTimeline = []; 
            }
            saveState();
        }

        function processWicket() {
            let nextPlayer = prompt("ENTERING BATSMAN NAME:");
            if(nextPlayer) {
                matchState.w++;
                triggerOverlayFX("fx-wicket", "OUT!");
                matchState.overTimeline.push("W");
                matchState.pship = { r: 0, b: 0 }; 
                
                if(matchState.strikePos === 1) matchState.bat1 = { n: nextPlayer.toUpperCase(), r: 0, b: 0 };
                else matchState.bat2 = { n: nextPlayer.toUpperCase(), r: 0, b: 0 };
                
                saveState();
            }
        }

        function manualStrikeSwap() { 
            matchState.strikePos = (matchState.strikePos === 1) ? 2 : 1; 
            saveState(); 
        }

        function toggleStrikeMode() { 
            matchState.autoStrike = !matchState.autoStrike; 
            saveState(); 
        }

        function switchInnings() { 
            matchState.inningNum = (matchState.inningNum === 1) ? 2 : 1; 
            saveState(); 
        }

        // --- DATA SYNCING ---
        function pushState() {
            if(localStorage.getItem("pro_access_v5") !== "true") return;
            
            matchState.tourName = document.getElementById('i-tour').value.toUpperCase() || matchState.tourName;
            matchState.tName = document.getElementById('i-t1').value.toUpperCase() || matchState.tName;
            matchState.bat1.n = document.getElementById('i-b1').value.toUpperCase() || matchState.bat1.n;
            matchState.bat2.n = document.getElementById('i-b2').value.toUpperCase() || matchState.bat2.n;
            matchState.bowler = document.getElementById('i-bowl').value.toUpperCase() || matchState.bowler;
            matchState.targetVal = parseInt(document.getElementById('i-target').value) || 0;
            matchState.maxOvers = parseInt(document.getElementById('i-max-ov').value) || 20;
            matchState.oppInfo = document.getElementById('i-opp-score').value || matchState.oppInfo;
            
            saveState();
        }

        function saveState() { refMain.set(matchState); }

        function syncInputs() {
            document.getElementById('i-tour').value = matchState.tourName;
            document.getElementById('i-t1').value = matchState.tName;
            document.getElementById('i-b1').value = matchState.bat1.n;
            document.getElementById('i-b2').value = matchState.bat2.n;
            document.getElementById('i-bowl').value = matchState.bowler;
            document.getElementById('i-target').value = matchState.targetVal;
            document.getElementById('i-max-ov').value = matchState.maxOvers;
            document.getElementById('i-opp-score').value = matchState.oppInfo;
            
            document.getElementById('auto-btn').innerText = "AUTO STRIKE: " + (matchState.autoStrike ? "ON" : "OFF");
            document.getElementById('inn-btn').innerText = "INN " + matchState.inningNum;
            
            // Analytics UI Sync
            document.getElementById('v-pship').innerText = `${matchState.pship.r} (${matchState.pship.b})`;
            let totalBalls = (matchState.o * 6) + matchState.b;
            let crr = totalBalls > 0 ? (matchState.r / totalBalls) * 6 : 0;
            document.getElementById('v-crr').innerText = crr.toFixed(2);
            document.getElementById('v-balls').innerText = totalBalls;
            
            if(matchState.inningNum === 2 && matchState.targetVal > 0) {
                let ballsRem = (matchState.maxOvers * 6) - totalBalls;
                let rNeeded = matchState.targetVal - matchState.r;
                let rrr = ballsRem > 0 ? (rNeeded / ballsRem) * 6 : 0;
                document.getElementById('v-rrr').innerText = rrr.toFixed(2);
            }

            const logPanel = document.getElementById('over-analysis');
            logPanel.innerHTML = "";
            (matchState.overTimeline || []).forEach(v => {
                logPanel.innerHTML += `<span class="ball-item">${v}</span>`;
            });
        }

        // --- UI RENDERING ---
        function updateUI() {
            document.getElementById('d-runs').innerText = matchState.r;
            document.getElementById('d-wkt').innerText = matchState.w;
            document.getElementById('d-ov').innerText = matchState.o + "." + matchState.b;
            document.getElementById('d-team').innerText = matchState.tName;
            document.getElementById('d-tour').innerText = matchState.tourName;
            document.getElementById('d-bowl').innerText = matchState.bowler;
            document.getElementById('d-opp-score').innerText = matchState.oppInfo;
            document.getElementById('d-target').innerText = matchState.targetVal;

            document.getElementById('d-b1').innerText = matchState.bat1.n;
            document.getElementById('d-b1-r').innerText = `${matchState.bat1.r} (${matchState.bat1.b})`;
            document.getElementById('d-b2').innerText = matchState.bat2.n;
            document.getElementById('d-b2-r').innerText = `${matchState.bat2.r} (${matchState.bat2.b})`;

            // Strike Indicator
            document.getElementById('p1-row').className = (matchState.strikePos === 1) ? "player-row striker-active" : "player-row";
            document.getElementById('p2-row').className = (matchState.strikePos === 2) ? "player-row striker-active" : "player-row";

            // Over Ball Tracker
            const dots = document.querySelectorAll('.ball-circle');
            dots.forEach((d, i) => {
                if(i < matchState.b) d.classList.add('filled');
                else d.classList.remove('filled');
            });

            // Match Status Info
            if(matchState.inningNum === 2 && matchState.targetVal > 0) {
                let runReq = matchState.targetVal - matchState.r;
                let bRem = (matchState.maxOvers * 6) - ((matchState.o * 6) + matchState.b);
                document.getElementById('d-status').innerText = `NEED ${runReq} RUNS FROM ${bRem} BALLS`;
            } else {
                document.getElementById('d-status').innerText = "1ST INNINGS IN PROGRESS";
            }

            // Projected Score
            let tPlayed = (matchState.o * 6) + matchState.b;
            if(tPlayed > 0) {
                let curRR = (matchState.r / tPlayed) * 6;
                document.getElementById('d-proj').innerText = "PROJ: " + Math.round(curRR * matchState.maxOvers);
            }
        }

        // --- DATA PERSISTENCE ---
        function archiveMatchData() {
            if(confirm("SAVE MATCH TO DATABASE?")) {
                const log = {
                    title: matchState.tName + " FINAL SCORE",
                    score: `${matchState.r}-${matchState.w} (${matchState.o}.${matchState.b})`,
                    tour: matchState.tourName,
                    timestamp: new Date().toLocaleString()
                };
                refHist.push(log);
                fullSystemReset(true);
            }
        }

        function fullSystemReset(silent = false) {
            if(!silent && !confirm("DANGER: WIPE ALL LIVE DATA?")) return;
            refMain.set({
                r: 0, w: 0, o: 0, b: 0, tName: "TEAM A", tourName: "TOURNAMENT", oppInfo: "0-0 (0.0)", targetVal: 0, strikePos: 1,
                bat1: { n: "PLAYER 1", r: 0, b: 0 }, bat2: { n: "PLAYER 2", r: 0, b: 0 }, pship: {r:0, b:0}, bowler: "READY", inningNum: 1, maxOvers: 20, autoStrike: true, animType: "", overTimeline: []
            });
        }

        function fetchHistory() {
            refHist.on('value', snap => {
                const list = document.getElementById('history-list');
                list.innerHTML = "";
                const data = snap.val();
                if(data) {
                    Object.values(data).reverse().forEach(m => {
                        list.innerHTML += `
                            <div style="background:rgba(255,255,255,0.05); padding:20px; border-radius:15px; margin-bottom:15px; border-left:6px solid var(--primary);">
                                <div style="display:flex; justify-content:space-between; align-items:center;">
                                    <strong style="font-size:18px;">${m.title}</strong>
                                    <span style="color:var(--primary); font-size:20px;">${m.score}</span>
                                </div>
                                <div style="font-size:12px; color:#555; margin-top:8px;">${m.tour} | ${m.timestamp}</div>
                            </div>
                        `;
                    });
                }
            });
        }

        // --- EXTRA ANALYTICS ENGINE (ADDITIONAL CODE) ---
        function calculateStrikeRate(runs, balls) {
            if(balls === 0) return "0.00";
            return ((runs / balls) * 100).toFixed(2);
        }

        function matchPhase() {
            if(matchState.o < 6) return "POWERPLAY";
            if(matchState.o >= 15) return "DEATH OVERS";
            return "MIDDLE OVERS";
        }

    </script>
</body>
</html>
