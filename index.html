<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chhotu Ultra-Pro Scorer 2026</title>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@700;900&family=Oswald:wght@500;700&display=swap');
        
        :root { --primary: #fec309; --neon-blue: #00e1ff; --neon-red: #ff0040; --bg: #030a16; }

        body { background: var(--bg); color: white; font-family: 'Oswald', sans-serif; margin: 0; padding-bottom: 50px; }

        @keyframes flash-yellow { 0% { background: #00122e; } 50% { background: #fec309; } 100% { background: #00122e; } }
        @keyframes flash-red { 0% { background: #00122e; } 50% { background: #ff0040; } 100% { background: #00122e; } }
        .animate-four-six { animation: flash-yellow 0.5s ease 3; }
        .animate-wicket { animation: flash-red 0.5s ease 3; }

        .master-container { width: 100%; max-width: 1000px; margin: auto; position: sticky; top: 0; z-index: 1000; background: var(--bg); border-bottom: 2px solid #222; }
        .top-status-bar { background: #000; display: flex; justify-content: space-between; align-items: center; padding: 5px 20px; font-size: 12px; font-family: 'Orbitron'; border-bottom: 1px solid #222; }

        .win-bar-container { height: 6px; background: #111; position: relative; display: flex; overflow: hidden; }
        #win-p1 { background: var(--neon-blue); height: 100%; transition: 1s; box-shadow: 0 0 10px var(--neon-blue); }
        #win-p2 { background: var(--neon-red); height: 100%; transition: 1s; box-shadow: 0 0 10px var(--neon-red); }

        .main-board { height: 70px; background: linear-gradient(90deg, #00122e 0%, #002b6b 100%); display: flex; align-items: center; position: relative; overflow: hidden; border-bottom: 3px solid var(--primary); }
        .team-tag { background: var(--primary); color: #000; font-weight: 900; font-size: 22px; padding: 0 25px; height: 100%; display: flex; align-items: center; clip-path: polygon(0 0, 85% 0, 100% 100%, 0% 100%); font-family: 'Orbitron'; }
        .live-score { font-size: 42px; font-weight: 900; padding: 0 15px; font-family: 'Orbitron'; letter-spacing: -2px; }
        .overs-small { font-size: 18px; opacity: 0.8; color: #ccc; margin-left: 15px; letter-spacing: 2px; font-weight: bold; }

        .batsmen-section { flex-grow: 1; padding: 0 20px; border-left: 1px solid rgba(255,255,255,0.1); }
        .b-row { font-size: 18px; display: flex; justify-content: space-between; margin: 2px 0; }
        .active-bat { color: var(--primary); text-shadow: 0 0 10px rgba(254,195,9,0.5); }

        .opp-box { background: rgba(255,255,255,0.05); height: 100%; padding: 0 15px; display: flex; flex-direction: column; justify-content: center; text-align: center; min-width: 120px; border-left: 1px solid #333; }
        .target-label { font-size: 10px; color: var(--primary); letter-spacing: 1px; }

        .bottom-strip { background: #000; padding: 5px 15px; display: flex; justify-content: space-between; align-items: center; font-size: 13px; font-weight: 700; }
        .ball-tracker { display: flex; gap: 5px; }
        .b-dot { width: 22px; height: 22px; background: #222; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 10px; border: 1px solid #444; }
        .b-dot.active { background: var(--primary); color: #000; border-color: #fff; box-shadow: 0 0 8px var(--primary); }

        /* --- HISTORY STYLES --- */
        .history-btn-nav { background: #111; padding: 10px; text-align: center; border-bottom: 1px solid #333; }
        .history-panel { max-width: 900px; margin: 20px auto; padding: 15px; display: none; }
        .history-item { background: #0a1221; padding: 15px; border-radius: 8px; margin-bottom: 10px; cursor: pointer; border-left: 5px solid var(--primary); }
        .history-item:hover { background: #131e33; }
        .history-details { background: #000; padding: 15px; border-radius: 8px; margin-top: 10px; display: none; border: 1px solid #333; }
        .player-stat { display: flex; justify-content: space-between; padding: 5px 0; border-bottom: 1px solid #222; font-size: 14px; }

        /* --- ADMIN PANEL --- */
        .admin-section { padding: 20px; max-width: 900px; margin: auto; }
        .login-card { text-align: center; background: #111; padding: 40px; border-radius: 15px; border: 1px solid #333; margin-top: 20px; }
        .control-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 15px; }
        .card { background: #0a1221; padding: 20px; border-radius: 12px; border: 1px solid #1a2a44; }
        .btn-group { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; margin-bottom: 15px; }
        button { padding: 12px; font-weight: 900; border: none; border-radius: 6px; cursor: pointer; transition: 0.2s; font-family: 'Oswald'; }
        .btn-run { background: #1a73e8; color: white; }
        .btn-action { background: var(--primary); color: #000; }
        .btn-danger { background: var(--neon-red); color: white; }
        input { width: 93%; padding: 12px; margin-bottom: 10px; background: #000; border: 1px solid #333; color: white; border-radius: 6px; }
        label { font-size: 12px; color: var(--primary); display: block; margin-bottom: 5px; }
        
        #boundary-msg { position: fixed; top: 30%; left: 0; width: 100%; background: var(--primary); color: #000; font-size: 70px; font-weight: 900; text-align: center; padding: 20px 0; display: none; z-index: 2000; font-family: 'Orbitron'; }
        .hidden { display: none !important; }
    </style>
</head>
<body onload="initApp()">

    <div id="boundary-msg">FOUR!</div>

    <div class="master-container">
        <div class="top-status-bar">
            <span><span id="d-tour">TOURNAMENT</span> | <span id="d-proj" style="color:var(--primary)"></span></span>
            <span id="d-clock">00:00:00</span>
        </div>
        <div class="main-board">
            <div class="team-tag" id="d-team">TEAM A</div>
            <div class="live-score">
                <span id="d-runs">0</span>-<span id="d-wkt">0</span>
                <span class="overs-small">(<span id="d-ov">0 . 0</span>)</span>
            </div>
            <div class="batsmen-section">
                <div id="p1-row" class="b-row active-bat"><span id="d-b1">BATSMAN 1</span> <span id="d-b1-r">0(0)</span></div>
                <div id="p2-row" class="b-row"><span id="d-b2">BATSMAN 2</span> <span id="d-b2-r">0(0)</span></div>
            </div>
        </div>
    </div>

    <div class="history-btn-nav">
        <button class="btn-action" onclick="toggleHistory()">üìñ VIEW MATCH HISTORY</button>
        <button class="btn-run" onclick="location.reload()">üîÑ LIVE SCORE</button>
    </div>

    <div id="history-panel" class="history-panel">
        <h2 style="color:var(--primary); text-align: center;">MATCH RESULTS ARCHIVE</h2>
        <div id="history-list">
            </div>
    </div>

    <div class="admin-section" id="admin-main-view">
        <div id="login-area" class="login-card">
            <h1 style="color:var(--primary); font-family: 'Orbitron';">üõ°Ô∏è ADMIN ACCESS</h1>
            <input type="password" id="pass-input" placeholder="ENTER SECURE PIN" style="text-align:center; font-size: 24px;">
            <button class="btn-action" onclick="checkAuth()" style="width:100%; padding:20px;">UNLOCK CONTROLS</button>
        </div>

        <div id="admin-panel" class="hidden">
            <div style="display:flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2 style="color:var(--primary)">CONTROL DASHBOARD</h2>
                <button class="btn-danger" onclick="lockPanel()">üîí LOCK</button>
            </div>

            <div class="control-grid">
                <div class="card">
                    <label>Quick Scoring</label>
                    <div class="btn-group">
                        <button class="btn-run" onclick="addRun(1)">+1</button>
                        <button class="btn-run" onclick="addRun(2)">+2</button>
                        <button class="btn-run" onclick="addRun(4)">4</button>
                        <button class="btn-run" onclick="addRun(6)">6</button>
                    </div>
                    <button class="btn-danger" onclick="outPlayer()" style="width:100%; margin-bottom:10px;">WICKET</button>
                    <button class="btn-run" onclick="nextBall()" style="width:100%; background:#00c853;">NEXT BALL</button>
                    <button class="btn-action" onclick="archiveMatch()" style="width:100%; margin-top:20px; background:#f44336; color:white;">üíæ SAVE MATCH TO HISTORY</button>
                </div>

                <div class="card">
                    <label>Match Setup</label>
                    <input type="text" id="i-t1" placeholder="Batting Team" oninput="pushData()">
                    <input type="text" id="i-opp" placeholder="Opponent Team" oninput="pushData()">
                    <input type="text" id="i-b1" placeholder="Striker Name" oninput="pushData()">
                    <input type="text" id="i-b2" placeholder="Non-Striker Name" oninput="pushData()">
                </div>
            </div>
        </div>
    </div>

    <script>
        const firebaseConfig = { databaseURL: "Https://myscoreboard-b140f-default-rtdb.firebaseio.com/" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database().ref("broadcast_master_v3");
        const histDb = firebase.database().ref("match_history");

        let state = {
            r:0, w:0, o:0, b:0, t1:"TEAM A", oppN:"OPPONENT",
            p1:{n:"BATSMAN 1", r:0, b:0}, p2:{n:"BATSMAN 2", r:0, b:0},
            s:1, tour:"TOURNAMENT", anim:"",
            allPlayers: [] // For history
        };

        function checkAuth() {
            if(document.getElementById('pass-input').value === "ChhotuLive8718") {
                localStorage.setItem("admin_login", "true");
                showAdmin();
            } else { alert("Wrong PIN!"); }
        }

        function showAdmin() {
            document.getElementById('admin-panel').classList.remove('hidden');
            document.getElementById('login-area').classList.add('hidden');
        }

        function lockPanel() {
            localStorage.removeItem("admin_login");
            location.reload();
        }

        function initApp() {
            if(localStorage.getItem("admin_login") === "true") showAdmin();
            setInterval(() => { document.getElementById('d-clock').innerText = new Date().toLocaleTimeString(); }, 1000);
            db.on('value', snap => { if(snap.val()) { state = snap.val(); updateUI(); } });
            loadHistory();
        }

        function addRun(v) {
            state.r += v;
            if(state.s === 1) state.p1.r += v; else state.p2.r += v;
            if(v % 2 !== 0) swapStrike();
            pushData();
        }

        function nextBall() {
            if(state.s === 1) state.p1.b++; else state.p2.b++;
            state.b++;
            if(state.b >= 6) { state.o++; state.b = 0; swapStrike(); }
            pushData();
        }

        function outPlayer() {
            let n = prompt("Next Batsman Name:");
            if(n) {
                // Save current batsman to historical list before replacing
                let finishedPlayer = state.s === 1 ? {...state.p1} : {...state.p2};
                if(!state.allPlayers) state.allPlayers = [];
                state.allPlayers.push(finishedPlayer);
                
                state.w++;
                if(state.s === 1) state.p1 = {n:n, r:0, b:0}; else state.p2 = {n:n, r:0, b:0};
                pushData();
            }
        }

        function swapStrike() { state.s = state.s === 1 ? 2 : 1; pushData(); }

        function pushData() {
            if(!document.getElementById('admin-panel').classList.contains('hidden')) {
                state.t1 = document.getElementById('i-t1').value || state.t1;
                state.oppN = document.getElementById('i-opp').value || state.oppN;
                state.p1.n = document.getElementById('i-b1').value || state.p1.n;
                state.p2.n = document.getElementById('i-b2').value || state.p2.n;
            }
            db.set(state);
        }

        function updateUI() {
            document.getElementById('d-runs').innerText = state.r;
            document.getElementById('d-wkt').innerText = state.w;
            document.getElementById('d-ov').innerText = state.o + " . " + state.b;
            document.getElementById('d-team').innerText = state.t1.toUpperCase();
            document.getElementById('d-b1').innerText = state.p1.n;
            document.getElementById('d-b1-r').innerText = `${state.p1.r}(${state.p1.b})`;
            document.getElementById('d-b2').innerText = state.p2.n;
            document.getElementById('d-b2-r').innerText = `${state.p2.r}(${state.p2.b})`;
            document.getElementById('p1-row').className = state.s === 1 ? "b-row active-bat" : "b-row";
            document.getElementById('p2-row').className = state.s === 2 ? "b-row active-bat" : "b-row";
        }

        // --- HISTORY LOGIC ---
        function archiveMatch() {
            if(!confirm("Are you sure you want to end this match and save to history?")) return;
            
            const now = new Date();
            const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
            
            // Add current players to the final list
            let finalPlayers = state.allPlayers ? [...state.allPlayers] : [];
            finalPlayers.push(state.p1);
            finalPlayers.push(state.p2);

            const matchData = {
                teams: `${state.t1} vs ${state.oppN}`,
                score: `${state.r}-${state.w} (${state.o}.${state.b})`,
                date: now.toLocaleDateString(),
                time: now.toLocaleTimeString(),
                day: days[now.getDay()],
                players: finalPlayers
            };

            histDb.push(matchData).then(() => {
                alert("Match Saved Successfully!");
                db.set({ r:0, w:0, o:0, b:0, t1:"TEAM A", oppN:"OPPONENT", p1:{n:"BATSMAN 1", r:0, b:0}, p2:{n:"BATSMAN 2", r:0, b:0}, s:1, tour:"TOURNAMENT", allPlayers: [] });
                location.reload();
            });
        }

        function loadHistory() {
            histDb.on('value', snap => {
                const list = document.getElementById('history-list');
                list.innerHTML = "";
                const data = snap.val();
                if(!data) { list.innerHTML = "<p>No matches found.</p>"; return; }

                Object.keys(data).reverse().forEach((key, index) => {
                    const m = data[key];
                    let playerHtml = m.players.map(p => `
                        <div class="player-stat"><span>${p.n}</span> <span>${p.r} Runs (${p.b} Balls)</span></div>
                    `).join('');

                    list.innerHTML += `
                        <div class="history-item" onclick="document.getElementById('det-${key}').style.display = document.getElementById('det-${key}').style.display === 'block' ? 'none' : 'block'">
                            <div style="display:flex; justify-content:space-between;">
                                <strong>${index + 1}. ${m.teams}</strong>
                                <span style="color:var(--primary)">${m.score}</span>
                            </div>
                            <div style="font-size:11px; opacity:0.6; margin-top:5px;">${m.day} | ${m.date} | ${m.time}</div>
                            
                            <div id="det-${key}" class="history-details">
                                <h4 style="margin:0 0 10px 0; color:var(--neon-blue); border-bottom:1px solid #333;">FULL SCORECARD</h4>
                                ${playerHtml}
                            </div>
                        </div>
                    `;
                });
            });
        }

        function toggleHistory() {
            document.getElementById('history-panel').style.display = 'block';
            document.getElementById('admin-main-view').style.display = 'none';
            window.scrollTo(0,0);
        }
    </script>
</body>
</html>
